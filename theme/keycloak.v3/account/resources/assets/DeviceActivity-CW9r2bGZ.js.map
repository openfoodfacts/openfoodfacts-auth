{"version":3,"file":"DeviceActivity-CW9r2bGZ.js","sources":["../../../../../../../../../../node_modules/.pnpm/@patternfly+react-icons@5.4.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@patternfly/react-icons/dist/esm/icons/desktop-icon.js","../../../../../../../../../../node_modules/.pnpm/@patternfly+react-icons@5.4.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@patternfly/react-icons/dist/esm/icons/mobile-alt-icon.js","../../../../../../../src/account-security/DeviceActivity.tsx"],"sourcesContent":["import { createIcon } from '../createIcon';\n\nexport const DesktopIconConfig = {\n  name: 'DesktopIcon',\n  height: 512,\n  width: 576,\n  svgPath: 'M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z',\n  yOffset: 0,\n  xOffset: 0,\n};\n\nexport const DesktopIcon = createIcon(DesktopIconConfig);\n\nexport default DesktopIcon;","import { createIcon } from '../createIcon';\n\nexport const MobileAltIconConfig = {\n  name: 'MobileAltIcon',\n  height: 512,\n  width: 320,\n  svgPath: 'M272 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h224c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM160 480c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm112-108c0 6.6-5.4 12-12 12H60c-6.6 0-12-5.4-12-12V60c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v312z',\n  yOffset: 0,\n  xOffset: 0,\n};\n\nexport const MobileAltIcon = createIcon(MobileAltIconConfig);\n\nexport default MobileAltIcon;","import {\n  ContinueCancelModal,\n  useEnvironment,\n  label,\n} from \"@keycloak/keycloak-ui-shared\";\nimport {\n  Button,\n  DataList,\n  DataListContent,\n  DataListItem,\n  DataListItemRow,\n  DescriptionList,\n  DescriptionListDescription,\n  DescriptionListGroup,\n  DescriptionListTerm,\n  Grid,\n  GridItem,\n  Label,\n  Spinner,\n  Split,\n  SplitItem,\n  Title,\n} from \"@patternfly/react-core\";\nimport {\n  DesktopIcon,\n  MobileAltIcon,\n  SyncAltIcon,\n} from \"@patternfly/react-icons\";\nimport { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { deleteSession, getDevices } from \"../api/methods\";\nimport {\n  ClientRepresentation,\n  DeviceRepresentation,\n  SessionRepresentation,\n} from \"../api/representations\";\nimport { Page } from \"../components/page/Page\";\nimport { formatDate } from \"../utils/formatDate\";\nimport { useAccountAlerts } from \"../utils/useAccountAlerts\";\nimport { usePromise } from \"../utils/usePromise\";\n\nexport const DeviceActivity = () => {\n  const { t } = useTranslation();\n  const context = useEnvironment();\n  const { addAlert, addError } = useAccountAlerts();\n\n  const [devices, setDevices] = useState<DeviceRepresentation[]>();\n  const [key, setKey] = useState(0);\n  const refresh = () => setKey(key + 1);\n\n  const moveCurrentToTop = (devices: DeviceRepresentation[]) => {\n    let currentDevice = devices[0];\n\n    const index = devices.findIndex((d) => d.current);\n    currentDevice = devices.splice(index, 1)[0];\n    devices.unshift(currentDevice);\n\n    const sessionIndex = currentDevice.sessions.findIndex((s) => s.current);\n    const currentSession = currentDevice.sessions.splice(sessionIndex, 1)[0];\n    currentDevice.sessions.unshift(currentSession);\n\n    setDevices(devices);\n  };\n\n  usePromise((signal) => getDevices({ signal, context }), moveCurrentToTop, [\n    key,\n  ]);\n\n  const signOutAll = async () => {\n    await deleteSession(context);\n    context.keycloak.logout();\n  };\n\n  const signOutSession = async (\n    session: SessionRepresentation,\n    device: DeviceRepresentation,\n  ) => {\n    try {\n      await deleteSession(context, session.id);\n      addAlert(\n        t(\"signedOutSession\", { browser: session.browser, os: device.os }),\n      );\n      refresh();\n    } catch (error) {\n      addError(\"errorSignOutMessage\", error);\n    }\n  };\n\n  const makeClientsString = (clients: ClientRepresentation[]): string => {\n    let clientsString = \"\";\n    clients.forEach((client, index) => {\n      let clientName: string;\n      if (client.clientName !== \"\") {\n        clientName = label(t, client.clientName);\n      } else {\n        clientName = client.clientId;\n      }\n\n      clientsString += clientName;\n\n      if (clients.length > index + 1) clientsString += \", \";\n    });\n\n    return clientsString;\n  };\n\n  if (!devices) {\n    return <Spinner />;\n  }\n\n  return (\n    <Page\n      title={t(\"deviceActivity\")}\n      description={t(\"signedInDevicesExplanation\")}\n    >\n      <Split hasGutter className=\"pf-v5-u-mb-lg\">\n        <SplitItem isFilled>\n          <Title headingLevel=\"h2\" size=\"xl\">\n            {t(\"signedInDevices\")}\n          </Title>\n        </SplitItem>\n        <SplitItem>\n          <Button\n            id=\"refresh-page\"\n            variant=\"link\"\n            onClick={() => refresh()}\n            icon={<SyncAltIcon />}\n          >\n            {t(\"refreshPage\")}\n          </Button>\n\n          {(devices.length > 1 || devices[0].sessions.length > 1) && (\n            <ContinueCancelModal\n              buttonTitle={t(\"signOutAllDevices\")}\n              modalTitle={t(\"signOutAllDevices\")}\n              continueLabel={t(\"confirm\")}\n              cancelLabel={t(\"cancel\")}\n              onContinue={() => signOutAll()}\n            >\n              {t(\"signOutAllDevicesWarning\")}\n            </ContinueCancelModal>\n          )}\n        </SplitItem>\n      </Split>\n      <DataList\n        className=\"signed-in-device-list\"\n        aria-label={t(\"signedInDevices\")}\n      >\n        <DataListItem aria-labelledby={`sessions-${key}`}>\n          {devices.map((device) =>\n            device.sessions.map((session, index) => (\n              <DataListItemRow key={device.id} data-testid={`row-${index}`}>\n                <DataListContent\n                  aria-label=\"device-sessions-content\"\n                  className=\"pf-v5-u-flex-grow-1\"\n                >\n                  <Grid hasGutter>\n                    <GridItem span={1} rowSpan={2}>\n                      {device.mobile ? <MobileAltIcon /> : <DesktopIcon />}\n                    </GridItem>\n                    <GridItem sm={8} md={9} span={10}>\n                      <span className=\"pf-v5-u-mr-md session-title\">\n                        {device.os.toLowerCase().includes(\"unknown\")\n                          ? t(\"unknownOperatingSystem\")\n                          : device.os}{\" \"}\n                        {!device.osVersion.toLowerCase().includes(\"unknown\") &&\n                          device.osVersion}{\" \"}\n                        / {session.browser}\n                      </span>\n                      {session.current && (\n                        <Label color=\"green\">{t(\"currentSession\")}</Label>\n                      )}\n                    </GridItem>\n                    <GridItem\n                      className=\"pf-v5-u-text-align-right\"\n                      sm={3}\n                      md={2}\n                      span={1}\n                    >\n                      {!session.current && (\n                        <ContinueCancelModal\n                          buttonTitle={t(\"signOut\")}\n                          modalTitle={t(\"signOut\")}\n                          continueLabel={t(\"confirm\")}\n                          cancelLabel={t(\"cancel\")}\n                          buttonVariant=\"secondary\"\n                          onContinue={() => signOutSession(session, device)}\n                        >\n                          {t(\"signOutWarning\")}\n                        </ContinueCancelModal>\n                      )}\n                    </GridItem>\n                    <GridItem span={11}>\n                      <DescriptionList\n                        className=\"signed-in-device-grid\"\n                        columnModifier={{ sm: \"2Col\", lg: \"3Col\" }}\n                        cols={5}\n                        rows={1}\n                      >\n                        <DescriptionListGroup>\n                          <DescriptionListTerm>\n                            {t(\"ipAddress\")}\n                          </DescriptionListTerm>\n                          <DescriptionListDescription>\n                            {session.ipAddress}\n                          </DescriptionListDescription>\n                        </DescriptionListGroup>\n                        <DescriptionListGroup>\n                          <DescriptionListTerm>\n                            {t(\"lastAccessedOn\")}\n                          </DescriptionListTerm>\n                          <DescriptionListDescription>\n                            {formatDate(new Date(session.lastAccess * 1000))}\n                          </DescriptionListDescription>\n                        </DescriptionListGroup>\n                        <DescriptionListGroup>\n                          <DescriptionListTerm>\n                            {t(\"clients\")}\n                          </DescriptionListTerm>\n                          <DescriptionListDescription>\n                            {makeClientsString(session.clients)}\n                          </DescriptionListDescription>\n                        </DescriptionListGroup>\n                        <DescriptionListGroup>\n                          <DescriptionListTerm>\n                            {t(\"started\")}\n                          </DescriptionListTerm>\n                          <DescriptionListDescription>\n                            {formatDate(new Date(session.started * 1000))}\n                          </DescriptionListDescription>\n                        </DescriptionListGroup>\n                        <DescriptionListGroup>\n                          <DescriptionListTerm>\n                            {t(\"expires\")}\n                          </DescriptionListTerm>\n                          <DescriptionListDescription>\n                            {formatDate(new Date(session.expires * 1000))}\n                          </DescriptionListDescription>\n                        </DescriptionListGroup>\n                      </DescriptionList>\n                    </GridItem>\n                  </Grid>\n                </DataListContent>\n              </DataListItemRow>\n            )),\n          )}\n        </DataListItem>\n      </DataList>\n    </Page>\n  );\n};\n\nexport default DeviceActivity;\n"],"names":["DesktopIconConfig","DesktopIcon","createIcon","MobileAltIconConfig","MobileAltIcon","DeviceActivity","t","useTranslation","context","useEnvironment","addAlert","addError","useAccountAlerts","devices","setDevices","useState","key","setKey","refresh","usePromise","signal","getDevices","currentDevice","index","d","sessionIndex","s","currentSession","signOutAll","deleteSession","signOutSession","session","device","error","makeClientsString","clients","clientsString","client","clientName","label","jsxs","Page","Split","jsx","SplitItem","Title","Button","SyncAltIcon","ContinueCancelModal","DataList","DataListItem","DataListItemRow","DataListContent","Grid","GridItem","Label","DescriptionList","DescriptionListGroup","DescriptionListTerm","DescriptionListDescription","formatDate","Spinner"],"mappings":"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","x_google_ignoreList":[0,1]}