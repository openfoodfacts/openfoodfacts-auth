{"version":3,"file":"Page-yh5eMHLr.js","sources":["../../../../../../../src/utils/isRecord.ts","../../../../../../../src/api/constants.ts","../../../../../../../src/api/parse-response.ts","../../../../../../../src/api/request.ts","../../../../../../../src/components/page/Page.tsx"],"sourcesContent":["export const isRecord = (value: unknown): value is Record<string, unknown> =>\n  typeof value === \"object\" && value !== null;\n","export const CONTENT_TYPE_HEADER = \"content-type\";\nexport const CONTENT_TYPE_JSON = \"application/json\";\n","import { isRecord } from \"../utils/isRecord\";\nimport { CONTENT_TYPE_HEADER, CONTENT_TYPE_JSON } from \"./constants\";\n\nexport class ApiError extends Error {}\n\nexport async function parseResponse<T>(response: Response): Promise<T> {\n  const contentType = response.headers.get(CONTENT_TYPE_HEADER);\n  const isJSON = contentType ? contentType.includes(CONTENT_TYPE_JSON) : false;\n\n  if (!isJSON) {\n    throw new Error(\n      `Expected response to have a JSON content type, got '${contentType}' instead.`,\n    );\n  }\n\n  const data = await parseJSON(response);\n\n  if (!response.ok) {\n    throw new ApiError(getErrorMessage(data));\n  }\n\n  return data as T;\n}\n\nasync function parseJSON(response: Response): Promise<unknown> {\n  try {\n    return await response.json();\n  } catch (error) {\n    throw new Error(\"Unable to parse response as valid JSON.\", {\n      cause: error,\n    });\n  }\n}\n\nfunction getErrorMessage(data: unknown): string {\n  if (!isRecord(data)) {\n    throw new Error(\"Unable to retrieve error message from response.\");\n  }\n\n  const errorKeys = [\"error_description\", \"errorMessage\", \"error\"];\n\n  for (const key of errorKeys) {\n    const value = data[key];\n\n    if (typeof value === \"string\") {\n      return value;\n    }\n  }\n\n  throw new Error(\n    \"Unable to retrieve error message from response, no matching key found.\",\n  );\n}\n","import {\n  KeycloakContext,\n  type BaseEnvironment,\n} from \"@keycloak/keycloak-ui-shared\";\nimport Keycloak from \"keycloak-js\";\n\nimport { joinPath } from \"../utils/joinPath\";\nimport { CONTENT_TYPE_HEADER, CONTENT_TYPE_JSON } from \"./constants\";\n\nexport type RequestOptions = {\n  signal?: AbortSignal;\n  getAccessToken?: () => Promise<string | undefined>;\n  method?: \"POST\" | \"PUT\" | \"DELETE\";\n  searchParams?: Record<string, string>;\n  body?: unknown;\n};\n\nasync function _request(\n  url: URL,\n  { signal, getAccessToken, method, searchParams, body }: RequestOptions = {},\n): Promise<Response> {\n  if (searchParams) {\n    Object.entries(searchParams).forEach(([key, value]) =>\n      url.searchParams.set(key, value),\n    );\n  }\n\n  return fetch(url, {\n    signal,\n    method,\n    body: body ? JSON.stringify(body) : undefined,\n    headers: {\n      [CONTENT_TYPE_HEADER]: CONTENT_TYPE_JSON,\n      authorization: `Bearer ${await getAccessToken?.()}`,\n    },\n  });\n}\n\nexport async function request(\n  path: string,\n  { environment, keycloak }: KeycloakContext<BaseEnvironment>,\n  opts: RequestOptions = {},\n  fullUrl?: URL,\n) {\n  if (typeof fullUrl === \"undefined\") {\n    fullUrl = url(environment, path);\n  }\n  return _request(fullUrl, {\n    ...opts,\n    getAccessToken: token(keycloak),\n  });\n}\n\nexport const url = (environment: BaseEnvironment, path: string) =>\n  new URL(\n    joinPath(\n      environment.serverBaseUrl,\n      \"realms\",\n      environment.realm,\n      \"account\",\n      path,\n    ),\n  );\n\nexport const token = (keycloak: Keycloak) =>\n  async function getAccessToken() {\n    try {\n      await keycloak.updateToken(5);\n    } catch (error) {\n      await keycloak.login();\n    }\n\n    return keycloak.token;\n  };\n","import { PageSection, Text, TextContent, Title } from \"@patternfly/react-core\";\nimport { PropsWithChildren } from \"react\";\n\ntype PageProps = {\n  title: string;\n  description: string;\n};\n\nexport const Page = ({\n  title,\n  description,\n  children,\n}: PropsWithChildren<PageProps>) => {\n  return (\n    <>\n      <PageSection variant=\"light\">\n        <TextContent>\n          <Title headingLevel=\"h1\" data-testid=\"page-heading\">\n            {title}\n          </Title>\n          <Text component=\"p\">{description}</Text>\n        </TextContent>\n      </PageSection>\n      <PageSection variant=\"light\">{children}</PageSection>\n    </>\n  );\n};\n"],"names":["isRecord","value","CONTENT_TYPE_HEADER","CONTENT_TYPE_JSON","ApiError","parseResponse","response","contentType","data","parseJSON","getErrorMessage","error","errorKeys","key","_request","url","signal","getAccessToken","method","searchParams","body","request","path","environment","keycloak","opts","fullUrl","token","joinPath","Page","title","description","children","jsxs","Fragment","jsx","PageSection","TextContent","Title","Text"],"mappings":"sIAAO,MAAMA,EAAYC,GACvB,OAAOA,GAAU,UAAYA,IAAU,KCD5BC,EAAsB,eACtBC,EAAoB,mBCE1B,MAAMC,UAAiB,KAAM,CAAC,CAErC,eAAsBC,EAAiBC,EAAgC,CACrE,MAAMC,EAAcD,EAAS,QAAQ,IAAIJ,CAAmB,EAG5D,GAAI,EAFWK,EAAcA,EAAY,SAASJ,CAAiB,EAAI,IAGrE,MAAM,IAAI,MACR,uDAAuDI,CAAW,YAAA,EAIhE,MAAAC,EAAO,MAAMC,EAAUH,CAAQ,EAEjC,GAAA,CAACA,EAAS,GACZ,MAAM,IAAIF,EAASM,EAAgBF,CAAI,CAAC,EAGnC,OAAAA,CACT,CAEA,eAAeC,EAAUH,EAAsC,CACzD,GAAA,CACK,OAAA,MAAMA,EAAS,aACfK,EAAO,CACR,MAAA,IAAI,MAAM,0CAA2C,CACzD,MAAOA,CAAA,CACR,CACH,CACF,CAEA,SAASD,EAAgBF,EAAuB,CAC1C,GAAA,CAACR,EAASQ,CAAI,EACV,MAAA,IAAI,MAAM,iDAAiD,EAGnE,MAAMI,EAAY,CAAC,oBAAqB,eAAgB,OAAO,EAE/D,UAAWC,KAAOD,EAAW,CACrB,MAAAX,EAAQO,EAAKK,CAAG,EAElB,GAAA,OAAOZ,GAAU,SACZ,OAAAA,CAEX,CAEA,MAAM,IAAI,MACR,wEAAA,CAEJ,CCnCA,eAAea,EACbC,EACA,CAAE,OAAAC,EAAQ,eAAAC,EAAgB,OAAAC,EAAQ,aAAAC,EAAc,KAAAC,CAAyB,EAAA,GACtD,CACnB,OAAID,GACK,OAAA,QAAQA,CAAY,EAAE,QAAQ,CAAC,CAACN,EAAKZ,CAAK,IAC/Cc,EAAI,aAAa,IAAIF,EAAKZ,CAAK,CAAA,EAI5B,MAAMc,EAAK,CAChB,OAAAC,EACA,OAAAE,EACA,KAAME,EAAO,KAAK,UAAUA,CAAI,EAAI,OACpC,QAAS,CACP,CAAClB,CAAmB,EAAGC,EACvB,cAAe,UAAU,MAAMc,IAAkB,CAAA,EACnD,CAAA,CACD,CACH,CAEsB,eAAAI,EACpBC,EACA,CAAE,YAAAC,EAAa,SAAAC,GACfC,EAAuB,CAAC,EACxBC,EACA,CACI,OAAA,OAAOA,EAAY,MACXA,EAAAX,EAAIQ,EAAaD,CAAI,GAE1BR,EAASY,EAAS,CACvB,GAAGD,EACH,eAAgBE,EAAMH,CAAQ,CAAA,CAC/B,CACH,CAEO,MAAMT,EAAM,CAACQ,EAA8BD,IAChD,IAAI,IACFM,EACEL,EAAY,cACZ,SACAA,EAAY,MACZ,UACAD,CACF,CACF,EAEWK,EAASH,GACpB,gBAAgC,CAC1B,GAAA,CACI,MAAAA,EAAS,YAAY,CAAC,OACd,CACd,MAAMA,EAAS,OACjB,CAEA,OAAOA,EAAS,KAClB,ECjEWK,EAAO,CAAC,CACnB,MAAAC,EACA,YAAAC,EACA,SAAAC,CACF,IAGMC,EAAAC,EAAA,CAAA,SAAA,CAAAC,EAACC,EAAY,CAAA,QAAQ,QACnB,SAAAH,EAACI,EACC,CAAA,SAAA,CAAAF,EAACG,EAAM,CAAA,aAAa,KAAK,cAAY,eAClC,SACHR,EAAA,EACCK,EAAAI,EAAA,CAAK,UAAU,IAAK,SAAYR,EAAA,CAAA,CAAA,CACnC,CACF,CAAA,EACCI,EAAAC,EAAA,CAAY,QAAQ,QAAS,SAAAJ,CAAS,CAAA,CACzC,CAAA,CAAA"}